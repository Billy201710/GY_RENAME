# 阶段二：用户界面开发规划

## 概述

阶段二的主要目标是实现GY_Rename的用户界面，包括三栏式布局、文件拖拽功能、设置对话框、文件列表组件和操作按钮等。本阶段将基于阶段一已完成的基础架构，着重于提供直观、美观、易用的用户界面。

## 开发任务分解

### 1. 实现主窗口和三栏式布局

#### 1.1 MainWindow类增强
- **任务描述**：完善主窗口类，实现基本布局和菜单/工具栏
- **具体工作**：
  - 实现三栏式布局，使用QSplitter确保可调整各栏宽度
  - 添加标题栏和状态栏
  - 实现工具栏，添加各种操作按钮
  - 添加菜单项，提供更多操作选项
  - 实现窗口尺寸和位置的保存与恢复
- **相关文件**：`src/views/main_window.py`
- **优先级**：高
- **预计工时**：8小时

#### 1.2 应用样式设计
- **任务描述**：设计并应用统一的视觉风格
- **具体工作**：
  - 创建应用程序样式表
  - 定义主题色彩、字体、控件样式等
  - 实现深色/浅色模式切换功能
  - 确保所有控件遵循统一的视觉风格
- **相关文件**：`assets/styles/app_style.qss`
- **优先级**：中
- **预计工时**：6小时

### 2. 开发文件拖拽功能

#### 2.1 拖放事件处理
- **任务描述**：实现文件的拖入和拖动排序功能
- **具体工作**：
  - 完善FileListWidget类的拖放事件处理
  - 支持从外部文件管理器拖入文件
  - 实现列表内部的拖动排序
  - 添加拖放提示和视觉反馈
- **相关文件**：`src/views/file_list_widget.py`
- **优先级**：高
- **预计工时**：10小时

#### 2.2 MIME数据处理
- **任务描述**：实现文件拖放的数据处理
- **具体工作**：
  - 处理文件路径的MIME数据
  - 支持多种文件格式的识别
  - 实现拖放操作的撤销/重做功能
- **相关文件**：`src/utils/drag_drop_utils.py`(新建)
- **优先级**：中
- **预计工时**：4小时

### 3. 创建设置对话框

#### 3.1 设置对话框UI完善
- **任务描述**：增强设置对话框的功能和界面
- **具体工作**：
  - 完善SettingsDialog类
  - 添加分组标签页，分类显示设置项
  - 实现各种设置控件（文本框、下拉框、复选框等）
  - 添加设置验证和错误提示
  - 实现设置的导入/导出功能
- **相关文件**：`src/views/settings_dialog.py`
- **优先级**：中
- **预计工时**：8小时

#### 3.2 首次运行向导
- **任务描述**：设计首次运行的设置向导
- **具体工作**：
  - 创建FirstRunWizard类
  - 设计分步骤的设置流程
  - 引导用户完成初始设置
  - 添加API测试功能
- **相关文件**：`src/views/first_run_wizard.py`(新建)
- **优先级**：低
- **预计工时**：6小时

### 4. 实现文件列表组件

#### 4.1 FileListWidget增强
- **任务描述**：完善文件列表控件的功能
- **具体工作**：
  - 添加列表项的自定义渲染
  - 实现不同状态的视觉反馈
  - 添加文件类型图标
  - 支持列表排序和筛选
  - 实现虚拟滚动，优化大量文件的显示性能
- **相关文件**：`src/views/file_list_widget.py`
- **优先级**：高
- **预计工时**：12小时

#### 4.2 列表项组件开发
- **任务描述**：创建自定义列表项组件
- **具体工作**：
  - 设计FileListItem类
  - 实现不同列表需要的自定义控件（如编辑按钮）
  - 添加右键菜单功能
  - 实现列表项的选择和高亮显示
- **相关文件**：`src/views/file_list_item.py`(新建)
- **优先级**：高
- **预计工时**：8小时

### 5. 设计操作按钮和工具栏

#### 5.1 工具栏开发
- **任务描述**：设计并实现主工具栏
- **具体工作**：
  - 创建自定义ToolBar类
  - 添加各种操作按钮
  - 实现按钮的状态变化和反馈
  - 添加工具提示
  - 支持按钮的禁用/启用状态
- **相关文件**：`src/views/tool_bar.py`(新建)
- **优先级**：中
- **预计工时**：6小时

#### 5.2 底部操作栏
- **任务描述**：实现底部操作按钮区域
- **具体工作**：
  - 设计底部操作栏布局
  - 添加确认和清空按钮
  - 实现进度条和状态指示
  - 添加操作统计信息显示
- **相关文件**：`src/views/bottom_bar.py`(新建)
- **优先级**：中
- **预计工时**：4小时

## 开发顺序和依赖关系

建议按以下顺序进行开发：

1. 主窗口基本布局 (任务1.1)
2. 文件列表组件基础功能 (任务4.1和4.2)
3. 拖放功能实现 (任务2.1和2.2)
4. 设置对话框 (任务3.1)
5. 工具栏和底部操作栏 (任务5.1和5.2)
6. 应用样式统一 (任务1.2)
7. 首次运行向导 (任务3.2)

## 技术要点和实现细节

### 三栏式布局实现
- 使用QSplitter实现可调整宽度的分栏
- 每个分栏使用QVBoxLayout进行垂直排列
- 使用标题标签和内容区域的组合
- 保存和恢复分栏位置

### 文件拖放功能
- 重写QListWidget的dragEnterEvent、dragMoveEvent、dropEvent等方法
- 使用QMimeData处理拖放数据
- 实现自定义MIME类型用于内部拖放
- 添加拖放过程的视觉反馈

### 自定义列表项
- 继承QListWidgetItem或使用QListWidget的setItemWidget方法
- 为不同列表实现不同的自定义控件
- 实现鼠标悬停和选中状态的视觉效果
- 添加右键菜单功能

### 应用样式和主题
- 使用QSS (Qt样式表) 定义控件样式
- 实现主题切换功能
- 确保所有自定义控件都支持样式应用
- 提供统一的色彩和字体管理

## 测试计划

### 用户界面测试
- 验证三栏布局的正确显示和调整
- 测试不同屏幕分辨率下的显示效果
- 验证深色/浅色主题的切换

### 交互功能测试
- 测试文件的拖入和拖动排序
- 验证编辑按钮和右键菜单功能
- 测试工具栏和底部操作栏按钮的功能

### 性能测试
- 测试大量文件（100+）的显示和操作性能
- 验证拖放大量文件的响应时间
- 测试界面更新的流畅度

## 风险和缓解措施

### 跨平台兼容性
- **风险**：Windows和macOS下控件显示差异
- **缓解**：使用平台检测，针对不同平台应用不同样式，测试覆盖两个平台

### 性能问题
- **风险**：大量文件可能导致界面卡顿
- **缓解**：实现虚拟滚动，优化列表渲染，使用异步加载

### 用户体验问题
- **风险**：界面操作不够直观
- **缓解**：添加工具提示，提供操作反馈，实现简单的用户引导